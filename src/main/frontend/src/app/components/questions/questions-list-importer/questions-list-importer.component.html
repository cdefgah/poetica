<p mat-dialog-title>Импорт заданий</p>
<mat-dialog-content>
  <mat-horizontal-stepper [linear]="true" (selectionChange)="onStepChange($event)" #stepper>
    <mat-step [stepControl]="rawSourceTextFormGroup">
      <mat-tab-group>
        <mat-tab label="Текст с заданиями">
          <form>
            <ng-template matStepLabel>Ввод текста с заданиями</ng-template>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Текст с заданиями</mat-label>
              <textarea matInput rows="15" name="rawSourceText" placeholder="Скопируйте текст с заданиями сюда" required
                [(ngModel)]="sourceText"></textarea>
            </mat-form-field>
            <div>
              <button mat-button color="primary" matStepperNext>Далее</button>
            </div>
          </form>
        </mat-tab>
        <mat-tab label="Описание формата">
          <div class="table-container">
            <p>
              Предполагается, что все вопросы уже заранее созданы, проверены и
              остаётся лишь их&nbsp;оформить нужным образом, чтобы импортировать
              в&nbsp;систему.
            </p>

            <p>
              Обратите внимание, что по&nbsp;умолчанию импортируемые задания
              помечаются системой как зачётные. Для отметки вне-зачётных заданий
              применяйте способ, который будет описан ниже.
            </p>

            <p>
              Одно задание от&nbsp;другого отделяется новой строкой. Каждое
              задание состоит из&nbsp;следующих частей:
            </p>

            <ul>
              <li>Номер</li>
              <li>Заголовок</li>
              <li>Содержимое</li>
              <li>Авторский ответ на задание</li>
              <li>Комментарий к&nbsp;заданию</li>
              <li>Информация об&nbsp;источнике задания</li>
              <li>Информация об&nbsp;авторе задания</li>
            </ul>

            <h1>Номер и&nbsp;заголовок задания</h1>
            <p>
              Первой строкой текстового блока с&nbsp;заданием идёт строка
              с&nbsp;номером и заголовком задания. Номером импортируемого
              задания может быть ноль, либо положительное целое число. Номер
              задания должен быть уникальным и&nbsp;не повторяться. Перед
              номером задания надо ставить специальный зарезервированный символ
              #. После номера ставится двоеточие, которое отделяет номер
              от&nbsp;заголовка задания.
            </p>

            <p>Пример номера задания с&nbsp;заголовком</p>

            <p class="emphasized-text">#26: Праздничное настроение</p>

            <p>
              Для многокрылки, где каждое крыло оценивается отдельно, номер
              будет составным, по&nbsp;количеству крыльев. Например для
              двукрылки, в&nbsp;которой каждое крыло должно оцениваться
              отдельно, номер будет состоять из&nbsp;двух частей. Для подобным
              образом оцениваемой трёх-крылки&nbsp;&mdash; из&nbsp;трёх итд.
              Например:
            </p>

            <p class="emphasized-text">#7-8: Картинки с&nbsp;выставки</p>
            <p class="emphasized-text">
              #11-12-13: Стихотворение о&nbsp;тройке
            </p>

            <p>
              Отдельные номера разделяются символом&nbsp;&mdash; и&nbsp;должны
              идти в&nbsp;порядке возрастания.
            </p>

            <p>
              Если бескрылка внезачётная, то&nbsp;номер берется в&nbsp;круглые
              скобки.
            </p>

            <p>Например:</p>

            <p class="emphasized-text">#1: Зачётная бескрылка номер один</p>
            <p class="emphasized-text">
              #(2): Внезачётная бескрылка номер два
            </p>
            <p class="emphasized-text">
              #3-4: Зачётная двукрылка с&nbsp;номерами крыльев три и&nbsp;четыре
            </p>
            <p class="emphasized-text">
              #(3-4): Внезачётная двукрылка с&nbsp;номерами крыльев три
              и&nbsp;четыре
            </p>

            <p>
              После номера может следовать заголовок бескрылки. Это одна строка,
              и&nbsp;её задавать необязательно. Если заголовка нет,
              то&nbsp;после номера ничего не пишем, а&nbsp;само тело бескрылки
              начинается на&nbsp;следующей строке.
            </p>

            <p>
              Количество символов в&nbsp;заголовке задания не&nbsp;должно
              превышать
              {{ questionValidationService.maxTitleLength }}.
            </p>

            <h1>Содержимое задания</h1>

            <p>
              Содержимым задания может быть практически любой текст,
              не&nbsp;нарушающий данного формата. Например, если у&nbsp;нас
              венок бескрылок, то&nbsp;в&nbsp;содержании задания
              мы&nbsp;указываем все бескрылки, составляющие венок бескрылок. Вы,
              если хотите, можете дать какие-то номера этим составляющим венок
              бескрылкам. Но, пожалуйста, не&nbsp;используйте зарезервированный
              символ #, и нумеруйте эти бескрылки так, чтобы при выгрузке
              вопросов не&nbsp;возникло путаницы.
            </p>

            <p>
              Количество символов в&nbsp;cодержимом задания не&nbsp;должно
              превышать
              {{ questionValidationService.maxBodyLength }}.
            </p>

            <h1>Авторский ответ на задание</h1>
            <p>
              Этот раздел содержит авторский ответ на задание. Раздел начинается
              с новой строки и предваряется префиксом #R:
            </p>
            <p>
              Раздел обязателен для указания в каждом задании. Раздел может
              занимать несколько строк, префикс #R: только в начале блока с
              авторским ответом. Обратите внимание, что количество символов для
              этого раздела не должно превышать
              {{ questionValidationService.maxAuthorsAnswerLength }}.
            </p>

            <p>Пример указания авторского ответа:</p>

            <p class="emphasized-text">
              #R: Лошадка, везущая хворосту воз.
            </p>

            <h1>Комментарий к&nbsp;заданию</h1>
            <p>
              Комментарий к&nbsp;заданию начинается с&nbsp;новой строки
              и&nbsp;предваряется префиксом: #N:
            </p>

            <p>
              Комментарий может занимать несколько строк. Префикс #N:
              указывается только в&nbsp;начале блока с&nbsp;комментарием.
            </p>

            <p>Например:</p>
            <p class="sample-text-block">
              #N: Во&nbsp;время создания и&nbsp;обсуждения этой бескрылки было
              сломано двадцать три копья фирмы &laquo;Magnum Spear&raquo;.
            </p>

            <p>
              Комментарий не является обязательным для указания. Обратите внимание, что
              количество символов для блока с&nbsp;комментарием не&nbsp;должно
              превышать {{ questionValidationService.maxCommentLength }}
            </p>

            <h1>Информация об&nbsp;источнике задания</h1>
            <p>
              Информация об&nbsp;источнике задаётся на&nbsp;новой строке,
              и&nbsp;предваряется префиксом #S:
            </p>

            <p>Например:</p>

            <p class="emphasized-text">
              #S: А.С. Пушкин&nbsp;&mdash; Песни Западных Славян
            </p>

            <p>
              Источник является обязательным к&nbsp;указанию для каждого
              задания.
            </p>

            <p>
              Информация об&nbsp;источнике может занимать несколько строк.
              Префикс #S: указывается только в&nbsp;начале блока
              с&nbsp;информацией об&nbsp;источнике. Обратите внимание, что
              количество символов для блока с&nbsp;информацией об&nbsp;источнике
              не&nbsp;должно превышать
              {{ questionValidationService.maxSourceLength }}.
            </p>

            <p>Например:</p>

            <p class="sample-text-block">
              #S: А.С. Пушкин&nbsp;&mdash; Песни Западных Славян.<br />
              Использовано стихотворение &laquo;Видение Короля&raquo;,<br />
              есть влияние стихотворений Агнии Барто &laquo;Девочка
              чумазая&raquo;, &laquo;Блинчики&raquo; и&nbsp;&laquo;Хромая
              табуретка&raquo;.
            </p>

            <h1>Информация об&nbsp;авторе задания</h1>
            <p>
              Информация об авторе задания является обязательной к указанию.
              Этот раздел начинается с новой строки и предваряется префиксом #A:
            </p>
            <p>
              Этот раздел может занимать несколько строк. Префикс #A:
              указывается только в начале раздела с информацией об авторе.
              Обратите внимание, что количество символов в этом разделе не
              должно превышать
              {{ questionValidationService.maxAuthorInfoLength }}.
            </p>

            <h1>Разбор примера</h1>
            <p>
              Пример правильно сформированного текста с заданиями для импорта
              показан ниже:
            </p>
            <pre>
#1-2:
Мимо ристалищ, капищ,
мимо храмов и баров,
[...]
мимо больших базаров,
мира и горя мимо,
мимо Мекки и Рима,
[...]
идут по земле пилигримы.

#R: мимо шикарных кладбищ,
синим солнцем палимы,

#N: Двукрылка, ко дню рождения поэта

#S: Иосиф Бродский - Пилигримы

#A: Иоаким Брунович Турумбайский.

#(3-4):
Не выходи из комнаты, не совершай ошибку.
Зачем тебе Солнце, если ты куришь Шипку?
За дверью бессмысленно все, особенно — [...]
[...]

#R:  — возглас счастья.
Только в уборную — и сразу же возвращайся.

#N: Внезачётная двукрылка, ко дню рождения поэта

#S: Иосиф Бродский - Не выходи из комнаты

#A: Авдотья Васильевна Белова-Чернова.

#5: Венок

Мы урожая ждем от лучших лоз,
Чтоб красота жила, не увядая.
Пусть вянут лепестки созревших роз,
[...]

И на вопрос: "Где прячутся сейчас
Остатки красоты веселых лет?" -
Что скажешь ты? [...]
Но злой насмешкой будет твой ответ.

Прекрасный облик в зеркале ты видишь,
И, если повторить не поспешишь
[...]
Благословенья женщину лишишь.

Часов и дней безудержный поток
Уводит лето в сумрак зимних дней,
[...]
Земля мертва и белый плащ на ней.

#R: Хранит их память роза молодая.
На дне угасших глаз?
Свои черты, природу ты обидишь,
Где нет листвы, застыл в деревьях сок,

#S: Уильям Шекспир - Сонеты

#A: Автандил Шотаевич Топуридзе.

#6: О черногорцах
Так раскаятся ж нахалы:
Объявить их старшинам,
Чтобы ружья и кинжалы
[...]

Вот он шлет на нас пехоту
С сотней пушек и мортир,
И своих мамлюков роту,
[...]

#R: Все несли к моим ногам
И косматых кирасир.

#N: Давно планировали что-то из Пушкина.

#S: А.С Пушкин - Песни Западных Славян.
Бонапарте и Черногорцы.

#A: Караваев Михаил Сергеевич.

#(7): Внезачётная про Блока

Осенний вечер так печален;
Смежает очи тающий закат…
[...]
Над тусклым золотом прогалин.

#R: Леса в безмолвии холодном спят

#S: Александр Блок - Осенний вечер так печален

#A: Тарапулькина Зинаида Матвеевна.

            </pre>
            <p>&nbsp;</p>
            <p>Результаты разбора:</p>
            <table class="properties-table">
              <tr>
                <th>Свойство</th>
                <th>Значение</th>
              </tr>
              <tr>
                <td>Тип задания №1-2</td>
                <td>
                  Зачётное задание, двукрылка, с отдельной оценкой по каждому
                  крылу.
                </td>
              </tr>
              <tr>
                <td>Заголовок задания №1-2</td>
                <td>=== Отсутствует ===</td>
              </tr>
              <tr>
                <td>Текст задания №1-2</td>
                <td>
                  <pre>
                    Мимо ристалищ, капищ,
                    мимо храмов и баров,
                    [...]
                    мимо больших базаров,
                    мира и горя мимо,
                    мимо Мекки и Рима,
                    [...]
                    идут по земле пилигримы.
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Авторский ответ к заданию №1-2</td>
                <td>
                  <pre>
                    мимо шикарных кладбищ,
                    синим солнцем палимы,
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Комментарий к заданию №1-2</td>
                <td>Двукрылка, ко дню рождения поэта.</td>
              </tr>
              <tr>
                <td>Источник задания №1-2</td>
                <td>
                  Иосиф Бродский - Пилигримы.
                </td>
              </tr>
              <tr>
                <td>Информация об авторе задания №1-2</td>
                <td>Иоаким Брунович Турумбайский.</td>
              </tr>
              <tr>
                <td colspan="2" class="empty-row-for-properties-table"></td>
              </tr>
              <tr>
                <td>Тип задания №3-4</td>
                <td>
                  Внезачётное задание, двукрылка с отдельной оценкой каждого
                  крыла.
                </td>
              </tr>
              <tr>
                <td>Заголовок задания №3-4</td>
                <td>=== Отсутствует ===</td>
              </tr>
              <tr>
                <td>Текст задания №3-4</td>
                <td>
                  <pre>
                    Не выходи из комнаты, не совершай ошибку.
                    Зачем тебе Солнце, если ты куришь Шипку?
                    За дверью бессмысленно все, особенно — [...]
                    [...]
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Авторский ответ к заданию №3-4</td>
                <td>
                  <pre>
                    — возглас счастья.
                    Только в уборную — и сразу же возвращайся.
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Комментарий к заданию №3-4</td>
                <td>Внезачётная двукрылка, ко дню рождения поэта.</td>
              </tr>
              <tr>
                <td>Источник задания №3-4</td>
                <td>
                  Иосиф Бродский - Не выходи из комнаты.
                </td>
              </tr>
              <tr>
                <td>Информация об авторе задания №3-4</td>
                <td>Авдотья Васильевна Белова-Чернова.</td>
              </tr>
              <tr>
                <td colspan="2" class="empty-row-for-properties-table"></td>
              </tr>
              <tr>
                <td>Тип задания №5</td>
                <td>
                  Зачётное задание, Венок бескрылок.
                </td>
              </tr>
              <tr>
                <td>Заголовок задания №5</td>
                <td>
                  Венок
                </td>
              </tr>
              <tr>
                <td>Текст задания №5</td>
                <td>
                  <pre>
                    Мы урожая ждем от лучших лоз,
                    Чтоб красота жила, не увядая.
                    Пусть вянут лепестки созревших роз,
                    [...]
                    
                    И на вопрос: "Где прячутся сейчас
                    Остатки красоты веселых лет?" -
                    Что скажешь ты? [...]
                    Но злой насмешкой будет твой ответ.
                    
                    Прекрасный облик в зеркале ты видишь,
                    И, если повторить не поспешишь
                    [...]
                    Благословенья женщину лишишь.
                    
                    Часов и дней безудержный поток
                    Уводит лето в сумрак зимних дней,
                    [...]
                    Земля мертва и белый плащ на ней.
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Авторский ответ к заданию №5</td>
                <td>
                  <pre>
                    Хранит их память роза молодая.
                    На дне угасших глаз?
                    Свои черты, природу ты обидишь,
                    Где нет листвы, застыл в деревьях сок,
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Комментарий к заданию №5</td>
                <td>=== Отстутствует ===</td>
              </tr>
              <tr>
                <td>Источник задания №5</td>
                <td>Уильям Шекспир - Сонеты.</td>
              </tr>
              <tr>
                <td>Информация об авторе задания №5</td>
                <td>Автандил Шотаевич Топуридзе.</td>
              </tr>
              <tr>
                <td colspan="2" class="empty-row-for-properties-table"></td>
              </tr>
              <tr>
                <td>Тип задания №6</td>
                <td>
                  Зачётное задание, двукрылка, с общей оценкой двух крыльев.
                </td>
              </tr>
              <tr>
                <td>Заголовок задания №6</td>
                <td>
                  О черногорцах
                </td>
              </tr>
              <tr>
                <td>Текст задания №6</td>
                <td>
                  <pre>
                    Так раскаятся ж нахалы:
                    Объявить их старшинам,
                    Чтобы ружья и кинжалы
                    [...]
                    
                    Вот он шлет на нас пехоту
                    С сотней пушек и мортир,
                    И своих мамлюков роту,
                    [...]
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Авторский ответ к заданию №6</td>
                <td>
                  <pre>
                    Все несли к моим ногам
                    И косматых кирасир.
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Комментарий к заданию №6</td>
                <td>Давно планировали что-то из Пушкина.</td>
              </tr>
              <tr>
                <td>Источник задания №6</td>
                <td>
                  А.С Пушкин - Песни Западных Славян. Бонапарте и Черногорцы.
                </td>
              </tr>
              <tr>
                <td>Информация об авторе задания №6</td>
                <td>Караваев Михаил Сергеевич.</td>
              </tr>
              <tr>
                <td colspan="2" class="empty-row-for-properties-table"></td>
              </tr>
              <tr>
                <td>Тип задания №7</td>
                <td>
                  Внезачётное задание
                </td>
              </tr>
              <tr>
                <td>Заголовок задания №7</td>
                <td>
                  Внезачётная про Блока
                </td>
              </tr>
              <tr>
                <td>Текст задания №7</td>
                <td>
                  <pre>
                    Осенний вечер так печален;
                    Смежает очи тающий закат…
                    [...]
                    Над тусклым золотом прогалин.
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Авторский ответ к заданию №7</td>
                <td>
                  <pre>
                    Леса в безмолвии холодном спят
                  </pre>
                </td>
              </tr>
              <tr>
                <td>Комментарий к заданию №7</td>
                <td>=== Отстутствует ===</td>
              </tr>
              <tr>
                <td>Источник задания №7</td>
                <td>
                  Александр Блок - Осенний вечер так печален
                </td>
              </tr>
              <tr>
                <td>Информация об авторе задания №7</td>
                <td>Тарапулькина Зинаида Матвеевна.</td>
              </tr>
            </table>
            <br />
            <br />
            <br />
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-step>
    <mat-step [stepControl]="rawSourceTextFormGroup">
      <form>
        <ng-template matStepLabel>Предварительный просмотр и импорт</ng-template>
        <div *ngIf="
            dataIsReadyForImport;
            then processedDataBlock;
            else errorsBlock
          "></div>

        <ng-template #processedDataBlock>
          <div class="table-container">
            <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
              <ng-container matColumnDef="externalNumber">
                <th mat-header-cell *matHeaderCellDef>
                  &nbsp;&nbsp;Номер&nbsp;&nbsp;
                </th>
                <td mat-cell *matCellDef="let oneQuestion">
                  {{ oneQuestion.externalNumber }}
                </td>
              </ng-container>

              <ng-container matColumnDef="graded">
                <th mat-header-cell *matHeaderCellDef>
                  &nbsp;&nbsp;Зачётное?&nbsp;&nbsp;
                </th>
                <td mat-cell *matCellDef="let oneQuestion">
                  {{ oneQuestion.graded ? "Зачётное" : "Внезачётное" }}
                </td>
              </ng-container>

              <ng-container matColumnDef="title">
                <th mat-header-cell *matHeaderCellDef>
                  &nbsp;&nbsp;Заголовок&nbsp;&nbsp;
                </th>
                <td mat-cell *matCellDef="let oneQuestion">
                  {{ oneQuestion.title }}
                </td>
              </ng-container>

              <ng-container matColumnDef="body">
                <th mat-header-cell *matHeaderCellDef>
                  &nbsp;&nbsp;Содержание&nbsp;&nbsp;
                </th>
                <td mat-cell *matCellDef="let oneQuestion">
                  {{ oneQuestion.body }}
                </td>
              </ng-container>

              <ng-container matColumnDef="authorsAnswer">
                <th mat-header-cell *matHeaderCellDef>
                  &nbsp;&nbsp;Авторский ответ&nbsp;&nbsp;
                </th>
                <td mat-cell *matCellDef="let oneQuestion">
                  {{ oneQuestion.authorsAnswer }}
                </td>
              </ng-container>

              <ng-container matColumnDef="comment">
                <th mat-header-cell *matHeaderCellDef>
                  &nbsp;&nbsp;Комментарий&nbsp;&nbsp;
                </th>
                <td mat-cell *matCellDef="let oneQuestion">
                  {{ oneQuestion.comment }}
                </td>
              </ng-container>

              <ng-container matColumnDef="source">
                <th mat-header-cell *matHeaderCellDef>
                  &nbsp;&nbsp;Источник&nbsp;&nbsp;
                </th>
                <td mat-cell *matCellDef="let oneQuestion">
                  {{ oneQuestion.source }}
                </td>
              </ng-container>

              <ng-container matColumnDef="authorInfo">
                <th mat-header-cell *matHeaderCellDef>
                  &nbsp;&nbsp;Автор&nbsp;&nbsp;
                </th>
                <td mat-cell *matCellDef="let oneQuestion">
                  {{ oneQuestion.authorInfo }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="onRowClicked(row)"></tr>
            </table>
          </div>
        </ng-template>

        <ng-template #errorsBlock>
          <div>
            {{ foundError }}
          </div>
        </ng-template>

        <div>
          <button mat-button color="primary" matStepperPrevious>Назад</button>
        </div>
      </form>
    </mat-step>
  </mat-horizontal-stepper>
  <mat-divider></mat-divider>
</mat-dialog-content>
<mat-dialog-actions>
  <span class="fill-remaining-space"></span>
  <ng-template [ngIf]="dataIsReadyForImport">
    <button mat-raised-button color="primary" (click)="doImportQuestions()">
      Импортировать задания
    </button>
  </ng-template>
  <button mat-raised-button color="accent" (click)="cancelDialog()">
    Отмена
  </button>
</mat-dialog-actions>